## 可靠传输的实现机制

- 停止-等待协议SW

    - 发送方发送完一个数据分组后，不会立即发送下一个分组，需要等待接收方的确认分组或否认分组；如果接收方发的是否认分组，则发送方需要重新发送未接收成功的分组。可见在收到接收方发送的确认分组之前，发送方需要缓存刚发送的分组。直至分组接收成功。
    - 如果发现丢包怎么办，为解决这个问题，可以在发送完一个数据分组时，启动一个`超时计时器`。若到了超时计时器所设置的重传时间数据分组，这就叫做`超时重传`。一般可将重传时间选为略大于"从发送方到接收方的平均往返时间"
     ![图片](../imgs/network/68.jpg)
    - 如果`接收方发送的确认分组丢失`呢? 发送方则会因为超时重复发送分组；为了`避免分组重复`这种传输错误，必须给`每个分组带上序号`。对于停止-等待协议，由于每发送一个数据分组就停止等待，只要保证每发送一个新的数据分组，其发送序号与上次发送的数据分组的序号不同就可以了，因此用`一个比特来编号就够了（即0和1）`.
    - 如果`接收方发送的确认分组`超时呢？（即大于重传时间发送方才接收到该确认分组）这样发送方必定会`重传该分组`。之后超时的`确认分组`到达，接收方发达下一个分组;到这里我们便会发现问题。如下图第四种情况，解决办法就是给`确认分组也加上序号`
    ![图片](../imgs/network/70.jpg)
    ![图片](../imgs/network/71.jpg)

    - `停止-等待协议的信道利用率问题`
    ![图片](../imgs/network/72.jpg)

- 回退N帧协议GBN

    - 采用3个比特给分组编序号，即序号`0~7`
    - 需要一个发送窗口，发送窗口尺寸记作: M<sub>T</sub>,取值如下：
    $$
     1< W_T <= 2^3-1
    $$
    - 接收方的接收窗口尺寸记作： M<sub>R</sub> 值为`1`

    ### 无差错情况下：

    发送方以`0-7`序号，有序发送，假设数据分组（0，1，2，3，4）`按序`到达接收方，接收方按序接收分组，因为接收窗口尺寸为1，每接收一个分组，向前滑动一格，直到所有分组都正确接收，后再发送确认分组，正确接收多少个分组则发送多少个确认分组；发送方每正确接收一个确认分组，发送窗口向前滑动一格。
     - 累积确认：接收方不一定要对收到的数据分组逐个确认；而是对`按序`到达的最后一个分组发送确认。`ACKn`表示序号为n及以前的所有数据分组都已经正确接收。这种确认方式的优点在于，部分确认分组丢失也不影响发送方的确认。
        举例：如发方有序发送了1，2，3，4，5个分组，接收方在收到1，2时发送了一个ACK2确认发组，收到3，4，5后再发送个ACK5确认分组，但ACK2在传输过程中丢失了，发送方正确收到了ACK5确认分组。则认为前面5个分组都正确接收了。ACK2未能接收不影响。发送方的确认。

    ### 有差错情况下:
        
    假设接收方正确接收的最后一个分组序号为4,发送方接下来发送`5,6,7,0,1`,5号发生误码，接收方对其丢弃，继续接收6，但6与此时的接收窗口（序号为5）序号不匹配，则也被丢弃，同理7，0，1也被丢弃；接收方再连接发送4（5因为是误码不被计在其中）个ACK4确认分组。这4个ACK4经过传输到达发送方，因为之前发送方已经接收过ACK4。于是就是确认之前发送的（即4号之后发送的）分组有问题，重新发送。

    - 由上面例子可知：尽管序号为6，7，0，1的分组正确到达接收方，但因为5号误码 不被接受，它们也"受到牵连”，不被接收，发送方还要重传p-些数据分组，这就是所谓`GO-back-N`(回退N帧)，可见，当通信线路质量不好时，回退N帧协议的信道利用率并不比停止-等待协议高。

- 选择重传协议SR

>ps： 这三种可靠传输实现机制的基本原理并不仅限于数据链路层，可以yi8et到计算机网络体系结构的各层协议中。不因只局限在数据链路层。
